<!DOCTYPE html>
<html>
<head>
<script>
"use strict";
var callbacks = {
	'addPipeListItem':function(item){
		var itemArray = [];
		for(var i in item){itemArray.push(item[i]);}
		pipeList.addItem(itemArray);
	},
	updatePipeList:function(params){
	
	},
	updateInspector:function(params){
		
	},
	hello:function(params){
		return 'add in web | orient msg='+params;
	}

};

function handleMessageFromClient(msgType,params){
	var func = window.callbacks[msgType];
	if(func && func.call){
		return func(params);
	}else{
		alert('no such handler for'+msgType);
	}
}
function sendMessageToClient(msgType,params){
	if(window.notify) window.notify(msgType,params);
}

function $(id){return document.getElementById(id);}

</script>
<script>
var pipeList;
window.onload=function(){
	sendMessageToClient("window-ready");
	pipeList = new DataGrid($('pipeList'),[ 
		{name:'#',className:'index'},
		{name:'result',className:'result'},
		{name:'host',className:'host'},
		{name:'serverIp',className:'serverIp'},
		{name:'path',className:'path'},
		{name:'others..',className:'others'}
	]);
	
}
</script>
<script type="text/javascript">
"use strict";
if(!window.console){window.console={info:function(){}};}
// DataGrid
//(function(){

// begin of resize
// resize relate closure variables
var currentResizeHeaderEl;
var currentResizeColumn;
var startX;
var startWidth;
// resize relate functions
function onHeaderMouseMove(e){
	var offsetX = e.pageX - startX;
	currentResizeHeaderEl.style['width']=startWidth + offsetX + 'px';
	resizeColumn(currentResizeHeaderEl);
	
}
function resizeColumn(header){
	var columns = header.parentNode.parentNode.getElementsByClassName('dg-column');
	//console.info(columns);
	var index=Array.prototype.indexOf.call(header.parentNode.children,header);
	//console.info(columns[index]);
	columns[index].style['width']=window.getComputedStyle(header,null).width;
}
function onHeaderMouseDown(e){
	//console.info(e.target.parentNode);
	var column = e.target.parentNode;
	startX = e.pageX;
	currentResizeHeaderEl = column;
	startWidth = Number(window.getComputedStyle(currentResizeHeaderEl,null).width.split('px')[0]);
	document.addEventListener("mousemove",onHeaderMouseMove);
	document.addEventListener("mouseup",onHeaderMouseUp);
	// prevent select
	document.addEventListener('selectstart',preventDefaultAndStopPropagation,true);
}
function preventDefaultAndStopPropagation(e){e.preventDefault();e.stopPropagation();}
function onHeaderMouseUp(){
	document.removeEventListener("mouseup",onHeaderMouseUp);
	document.removeEventListener("mousemove",onHeaderMouseMove);
	
	document.removeEventListener('selectstart',preventDefaultAndStopPropagation,true);
}
// end of resize




var DataGrid = function(el,headers){
	this.container = el;
	this.container.dg=this;
	if(!el.className || el.className.indexOf('dg-container') ==-1){
		el.className = el.className?el.className+' dg-container':'dg-container';
	}
	var tmpHeaderHtml='<div class="dg-header-container">';
	var tmpHtml = '<div class="dg-list-container">';
	for(var i=0,l=headers.length;i<l;++i){
		var header = headers[i];
		var className = '';
		if(header.className){
			className = ' '+header.className;
		}
		tmpHeaderHtml += '<div class="dg-header'+ className +'"><span class="dg-resize-holder"></span><span style="float:left">'+header.name+'</span></div>';
		tmpHtml+='<ul class="dg-column'+className+'"></ul>';
	}
	tmpHtml+='</div>';
	tmpHeaderHtml += '</div>';
	//console.info(tmpHtml);
	this.container.innerHTML =tmpHeaderHtml +  tmpHtml;
	this.columns = this.container.getElementsByClassName('dg-column');
	var holders = this.container.getElementsByClassName('dg-resize-holder');
	for(var i=0,l=holders.length;i<l;++i){
		//console.info(holders[i]);
		resizeColumn(holders[i].parentNode);
		holders[i].addEventListener('mousedown',onHeaderMouseDown)
	}
	
	var that = this;
	this.container.addEventListener('mouseover',function(e){
		that.onItemMouseOver.call(that,e);
	});
}

DataGrid.prototype  = {
	addItem:function(item,topFragments){
		var l = this.columns.length;
		for(var i=0;i<l;++i){
			var row = document.createElement('li');
			row.className = 'dg-item';
			row.innerHTML = item[i]; //TODO escape
			if(topFragments){
				topFragments[i].appendChild(row);
			}else{
				this.columns[i].appendChild(row);	
			}
		}
	},
	addItems:function(items){
		var fragments = [];
		for(var i=0,l=this.columns.length;i<l;++i){
			fragments.push(document.createDocumentFragment());
		}
		for(var i=0,l=items.length;i<l;++i){
			this.addItem(items[i],fragments);
		}
		for(var i=0,l=this.columns.length;i<l;++i){
			this.columns[i].appendChild(fragments[i]);
		}
	},
	removeItem:function(params){
	
	},
	updateItem:function(params){
	
	},
	
	onItemMouseOver: function(e,thisObj){
		//console.info(arguments);
		var t = e.target;
		if(!t)return;
		while(t && t.className!='dg-container' && (t.tagName!='LI' || t.className=='dg-column')){
			t = t.parentNode;
		}
		if(t.className != 'dg-item'){
			return;
		}
		t.style['background']="rgba(3,32,42,0.3)";
		var n = Array.prototype.indexOf.call(t.parentNode.children,t);
		if(n == this.lastHoverIndex)return;
		this.cancelLastHover();
		this.lastHoverIndex = n;
		this.renderHover();
		//var i = t.indexOf(t.parentNode.children);
	},
	cancelLastHover:function(){
		if(this.lastHoverIndex == undefined)return;
		//console.info('cancelLastHover'+this.columns,this.lastHoverIndex);
		for(var i=0,l=this.columns.length;i<l;++i){
			//console.info(this.columns[i].children[this.lastHoverIndex]);
			this.columns[i].children[this.lastHoverIndex].style['background']='';
		}
	},
	renderHover:function(i){
		//console.info('renderHover'+this.columns,this.lastHoverIndex);
		for(var i=0,l=this.columns.length;i<l;++i){
			this.columns[i].children[this.lastHoverIndex].style['backgroundColor']='rgba(3,23,43,.3)';
		}
	}

};
window.DataGrid = DataGrid;
//}());
</script>

<style>
* {
	padding:0;
	margin:0
}
ul, li {
	list-style:none;
}
.dg-container {
	border:solid 1px #0F3;
	overflow:auto;
	display:-webkit-box;
	-webkit-box-orient:vertical;
}
.dg-list-container{
	display:-webkit-box;
	-webkit-box-orient:horizontal;
}
.dg-column {
	min-height:80px;
	text-overflow:ellipsis;
}
.dg-header-container{
	display:-webkit-box;
	-webkit-box-orient:horizontal;
}
.dg-header {
	/*resize:horizontal;*/
	overflow:hidden;
	border:solid 1px green
}
.dg-resize-holder {
	float:right;
	width:4px;
	height:20px;
 background:rgba(0,204,153,0.1)  z-index:100;
	float:right;
}
.dg-resize-holder:hover {
	cursor:move;
}
.dg-item {
	text-overflow:ellipsis;
	overflow:hidden;
}
</style>
<style>
.index {
	width:80px;
}
.host {
	width:300px;
}

#ruleList{
	height:300px;
	position:absolute;
	left:300px;
	top:100px;
	width:500px;
}

</style>
</head>
<body>

<div id="test">test..</div>

<div id="pipeList">

</div>
<div id="ruleList">

</div>
</body>
</html>
